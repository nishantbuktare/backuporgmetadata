!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Docxtemplater=e()}}((function(){return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){var r=t[a][1][e];return o(r||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";var n=e("xmldom"),o=n.DOMParser,i=n.XMLSerializer,a=e("./errors").throwXmlTagNotFound;function s(e){return e[e.length-1]}var u={nullGetter:function(e){return e.module?(e.module,""):"undefined"},overrideFont:!1,xmlFileNames:[],parser:function(e){return n=function(t){return"."===e?t:t[e]},(r="get")in(t={})?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t;var t,r,n},delimiters:{start:"{",end:"}"}};var l={"&":"&amp;","'":"&apos;","<":"&lt;",">":"&gt;",'"':"&quot;"},c=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;function p(e){return e.replace(c,"\\$&")}var f=Object.keys(l).map((function(e){var t=l[e];return{rstart:new RegExp(p(t),"g"),rend:new RegExp(p(e),"g"),start:t,end:e}}));var h=new RegExp(String.fromCharCode(160),"g");function d(e,t){var r=t.type,n=t.tag,o=t.position;return"tag"===r&&n===e&&"start"===o}function m(e,t){var r=t.type,n=t.tag,o=t.position;return"tag"===r&&n===e&&"end"===o}var g=/[\x00-\x08\x0B\x0C\x0E-\x1F]/;t.exports={isContent:function(e){return"placeholder"===e.type||"content"===e.type&&"insidetag"===e.position},isParagraphStart:function(e){return d("w:p",e)||d("a:p",e)},isParagraphEnd:function(e){return m("w:p",e)||m("a:p",e)},isTagStart:d,isTagEnd:m,isTextStart:function(e){return"tag"===e.type&&"start"===e.position&&e.text},isTextEnd:function(e){return"tag"===e.type&&"end"===e.position&&e.text},unique:function(e){for(var t={},r=[],n=0,o=e.length;n<o;++n)t.hasOwnProperty(e[n])||(t[e[n]]=!0,r.push(e[n]));return r},chunkBy:function(e,t){return e.reduce((function(e,r){var n=s(e);if(0===n.length)return n.push(r),e;var o=t(r);return"start"===o?e.push([r]):"end"===o?(n.push(r),e.push([])):n.push(r),e}),[[]]).filter((function(e){return e.length>0}))},last:s,mergeObjects:function(){for(var e={},t=void 0,r=void 0,n=0;n<arguments.length;n+=1){t=arguments[n],r=Object.keys(t);for(var o=0;o<r.length;o+=1)e[r[o]]=t[r[o]]}return e},xml2str:function(e){return(new i).serializeToString(e).replace(/xmlns:[a-z0-9]+="" ?/g,"")},str2xml:function(e,t){return new o({errorHandler:t}).parseFromString(e,"text/xml")},getRight:function(e,t,r){for(var n=r,o=e.length;n<o;n++){if(e[n].value==="</"+t+">")return n}a({position:"right",element:t,parsed:e,index:r})},getLeft:function(e,t,r){for(var n=r;n>=0;n--){var o=e[n];if(0===o.value.indexOf("<"+t)&&-1!==[">"," "].indexOf(o.value[t.length+1]))return n}a({position:"left",element:t,parsed:e,index:r})},pregMatchAll:function(e,t){for(var r=[],n=void 0;null!=(n=e.exec(t));)r.push({array:n,offset:n.index});return r},convertSpaces:function(e){return e.replace(h," ")},escapeRegExp:p,charMapRegexes:f,hasCorruptCharacters:function(e){return g.test(e)},defaults:u,wordToUtf8:function(e){for(var t=void 0,r=0,n=f.length;r<n;r++)t=f[r],e=e.replace(t.rstart,t.end);return e},utf8ToWord:function(e){"string"!=typeof e&&(e=e.toString());for(var t=void 0,r=0,n=f.length;r<n;r++)t=f[r],e=e.replace(t.rend,t.start);return e},concatArrays:function(e){for(var t=[],r=0;r<e.length;r++)for(var n=e[r],o=0,i=n.length;o<i;o++)t.push(n[o]);return t},charMap:l}},{"./errors":2,xmldom:19}],2:[function(e,t,r){"use strict";function n(e){this.name="GenericError",this.message=e,this.stack=new Error(e).stack}function o(e){this.name="TemplateError",this.message=e,this.stack=new Error(e).stack}function i(e){this.name="RenderingError",this.message=e,this.stack=new Error(e).stack}function a(e){this.name="ScopeParserError",this.message=e,this.stack=new Error(e).stack}function s(e){this.name="InternalError",this.properties={explanation:"InternalError"},this.message=e,this.stack=new Error(e).stack}n.prototype=Error.prototype,o.prototype=new n,i.prototype=new n,a.prototype=new n,s.prototype=new n,t.exports={XTError:n,XTTemplateError:o,XTInternalError:s,XTScopeParserError:a,RenderingError:i,throwMultiError:function(e){var t=new o("Multi error");throw t.properties={errors:e,id:"multi_error",explanation:"The template has multiple errors"},t},throwXmlTagNotFound:function(e){var t=new o('No tag "'+e.element+'" was found at the '+e.position);throw t.properties={id:"no_xml_tag_found_at_"+e.position,explanation:'No tag "'+e.element+'" was found at the '+e.position,part:e.parsed[e.index],parsed:e.parsed,index:e.index,element:e.element},t},throwCorruptCharacters:function(e){var t=e.tag,r=e.value,n=new i("There are some XML corrupt characters");throw n.properties={id:"invalid_xml_characters",xtag:t,value:r,explanation:"There are some corrupt characters for the field ${name}"},n},throwContentMustBeString:function(e){var t=new s("Content must be a string");throw t.properties.id="xmltemplater_content_must_be_string",t.properties.type=e,t},getUnmatchedLoopException:function(e){var t=e.location,r="start"===t?"unclosed":"unopened",n=new o(("start"===t?"Unclosed":"Unopened")+" loop"),i=e.part.value;return n.properties={id:r+"_loop",explanation:'The loop with tag "'+i+'" is '+r,xtag:i},n},throwRawTagShouldBeOnlyTextInParagraph:function(e){var t=new o("Raw tag should be the only text in paragraph"),r=e.part.value;throw t.properties={id:"raw_xml_tag_should_be_only_text_in_paragraph",explanation:'The tag "'+r+'" should be the only text in this paragraph',xtag:e.part.value,offset:e.part.offset,paragraphParts:e.paragraphParts},t},throwRawTagNotInParagraph:function(e){var t=new o("Raw tag not in paragraph"),r=e.part,n=r.value,i=r.offset;throw t.properties={id:"raw_tag_outerxml_invalid",explanation:'The tag "'+n+'" is not inside a paragraph',rootError:e.rootError,xtag:n,offset:i,postparsed:e.postparsed,expandTo:e.expandTo,index:e.index},t},getClosingTagNotMatchOpeningTag:function(e){var t=e.tags,r=new o("Closing tag does not match opening tag");return r.properties={id:"closing_tag_does_not_match_opening_tag",explanation:'The tag "'+t[0].value+'" is closed by the tag "'+t[1].value+'"',openingtag:t[0].value,offset:[t[0].offset,t[1].offset],closingtag:t[1].value},r},throwUnimplementedTagType:function(e){var t=new o('Unimplemented tag type "'+e.type+'"');throw t.properties={part:e,id:"unimplemented_tag_type"},t},getScopeCompilationError:function(e){var t=e.tag,r=e.rootError,n=new a("Scope parser compilation failed");return n.properties={id:"scopeparser_compilation_failed",tag:t,explanation:'The scope parser for the tag "'+t+'" failed to compile',rootError:r},n},getScopeParserExecutionError:function(e){var t=e.tag,r=e.scope,n=e.error,o=new a("Scope parser execution failed");return o.properties={id:"scopeparser_execution_failed",explanation:"The scope parser for the tag "+t+" failed to execute",scope:r,tag:t,rootError:n},o},getUnopenedTagException:function(e){var t,r=new o("Unopened tag");return r.properties={xtag:(t=e.xtag.split(" "),t[t.length-1]),id:"unopened_tag",context:e.xtag,offset:e.offset,lIndex:e.lIndex,explanation:'The tag beginning with "'+e.xtag.substr(0,10)+'" is unopened'},r},getUnclosedTagException:function(e){var t,r=new o("Unclosed tag");return r.properties={xtag:(t=e.xtag.split(" "),t[0]).substr(1),id:"unclosed_tag",context:e.xtag,offset:e.offset,lIndex:e.lIndex,explanation:'The tag beginning with "'+e.xtag.substr(0,10)+'" is unclosed'},r},throwMalformedXml:function(e){var t=new s("Malformed xml");throw t.properties={part:e,id:"malformed_xml"},t},throwFileTypeNotIdentified:function(){var e=new s("The filetype for this file could not be identified, is this file corrupted ?");throw e.properties={id:"filetype_not_identified"},e},throwFileTypeNotHandled:function(e){var t=new s('The filetype "'+e+'" is not handled by docxtemplater');throw t.properties={id:"filetype_not_handled",explanation:'The file you are trying to generate is of type "'+e+'", but only docx and pptx formats are handled'},t},getLoopPositionProducesInvalidXMLError:function(e){var t=e.tag,r=new o('The position of the loop tags "'+t+'" would produce invalid XML');return r.properties={tag:t,id:"loop_position_invalid",explanation:'The tags "'+t+'" are misplaced in the document, for example one of them is in a table and the other one outside the table'},r},throwLocationInvalid:function(e){throw new s('Location should be one of "start" or "end" (given : '+e.location+")")}}},{}],3:[function(e,t,r){"use strict";var n=e("./modules/loop"),o=e("./modules/space-preserve"),i=e("./modules/rawxml"),a=e("./modules/expand-pair-trait"),s=e("./modules/render"),u={getTemplatedFiles:function(e){return e.file(/ppt\/(slides|slideLayouts|slideMasters)\/(slide|slideLayout|slideMaster)\d+\.xml/).map((function(e){return e.name})).concat(["ppt/presentation.xml","docProps/app.xml","docProps/core.xml"])},textPath:function(){return"ppt/slides/slide1.xml"},tagsXmlTextArray:["a:t","m:t","vt:lpstr","dc:title","dc:creator","cp:keywords"],tagsXmlLexedArray:["p:sp","a:tc","a:tr","a:table","a:p","a:r"],expandTags:[{contains:"a:tc",expand:"a:tr"}],onParagraphLoop:[{contains:"a:p",expand:"a:p",onlyTextInTag:!0}],tagRawXml:"p:sp",tagTextXml:"a:t",baseModules:[n,a,i,s]},l={getTemplatedFiles:function(e){return e.file(/word\/(header|footer)\d+\.xml/).map((function(e){return e.name})).concat(["docProps/core.xml","docProps/app.xml","word/document.xml","word/document2.xml"])},textPath:function(e){return e.files["word/document.xml"]?"word/document.xml":e.files["word/document2.xml"]?"word/document2.xml":void 0},tagsXmlTextArray:["w:t","m:t","vt:lpstr","dc:title","dc:creator","cp:keywords"],tagsXmlLexedArray:["w:tc","w:tr","w:table","w:p","w:r","w:rPr","w:pPr","w:spacing"],expandTags:[{contains:"w:tc",expand:"w:tr"}],onParagraphLoop:[{contains:"w:p",expand:"w:p",onlyTextInTag:!0}],tagRawXml:"w:p",tagTextXml:"w:t",baseModules:[n,o,a,i,s]};t.exports={docx:l,pptx:u}},{"./modules/expand-pair-trait":7,"./modules/loop":8,"./modules/rawxml":9,"./modules/render":10,"./modules/space-preserve":11}],4:[function(e,t,r){"use strict";var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=e("./errors"),i=o.getUnclosedTagException,a=o.getUnopenedTagException,s=o.throwMalformedXml,u=e("./doc-utils"),l=u.concatArrays,c=u.isTextStart,p=u.isTextEnd,f=0,h=-1,d=1;function m(e,t){return e[0]<=t.offset&&t.offset<e[1]}function g(e,t){return c(e)?(t&&s(e),!0):p(e)?(t||s(e),!1):t}function v(e){var t="start",r=1;"/"===e[e.length-2]&&(t="selfclosing"),"/"===e[1]&&(r=2,t="end");var n=e.indexOf(" "),o=-1===n?e.length-1:n;return{tag:e.slice(r,o),position:t}}function y(e,t){return e===t?0:-1===e||-1===t?t<e?h:d:e<t?h:d}function x(e){var t=e.split(" ");if(2!==t.length)throw new Error("New Delimiters cannot be parsed");var r=n(t,2),o=r[0],i=r[1];if(0===o.length||0===i.length)throw new Error("New Delimiters cannot be parsed");return[o,i]}function w(e){var t=this;this.innerContentParts=e,this.full="",this.parseDelimiters=function(e){t.full=t.innerContentParts.map((function(e){return e.value})).join("");var r=function(e,t){for(var r=[],o=t.start,i=t.end,a=-1;;){var s=e.indexOf(o,a+1),u=e.indexOf(i,a+1),l=null,c=void 0,p=y(s,u);if(p===f)return r;if(p===d&&(a=u,l="end",c=i.length),p===h&&(a=s,l="start",c=o.length),"start"!==l||"="!==e[a+o.length])r.push({offset:a,position:l,length:c});else{r.push({offset:s,position:"start",length:o.length,changedelimiter:!0});var m=e.indexOf("=",a+o.length+1),g=e.indexOf(i,m+1);r.push({offset:g,position:"end",length:i.length,changedelimiter:!0});var v=x(e.substr(a+o.length+1,m-a-o.length-1)),w=n(v,2);o=w[0],i=w[1],a=g}}}(t.full,e),o=0,s=t.innerContentParts.map((function(e){return{offset:(o+=e.value.length)-e.value.length,lIndex:e.lIndex}})),u=function(e,t,r){if(0===e.length)return[];var n=[],o=!1,s={offset:0},u=void 0,l=0;e.forEach((function(e){for(;r[l+1]&&!(r[l+1].offset>e.offset);)l++;u=t.substr(s.offset,e.offset-s.offset),"start"===e.position&&o||"end"===e.position&&!o?"start"===e.position?(n.push(i({xtag:u,offset:s.offset})),e.error=!0):(n.push(a({xtag:u,offset:e.offset})),e.error=!0):o=!o,s=e}));var c={offset:t.length};return u=t.substr(s.offset,c.offset-s.offset),o&&(n.push(i({xtag:u,offset:s.offset})),c.error=!0),n}(r,t.full,s),l=0,c=0;t.parsed=s.map((function(e,t){for(var n=e.offset,o=[n,n+this.innerContentParts[t].value.length],i=this.innerContentParts[t].value,a=[];c<r.length&&m(o,r[c]);)a.push(r[c]),c++;var s=[],u=0;l>0&&(u=l,l=0);var p=void 0;a.forEach((function(e){var t=i.substr(u,e.offset-n-u);if(t.length>0){if(p)return void(e.changedelimiter&&(u=e.offset-n+e.length,p="start"===e.position));s.push({type:"content",value:t,offset:u+n}),u+=t.length}var r={type:"delimiter",position:e.position,offset:u+n};if(e.error&&(r.error=e.error),e.changedelimiter)return p="start"===e.position,void(u=e.offset-n+e.length);s.push(r),u=e.offset-n+e.length})),l=u-i.length;var f=i.substr(u);return f.length>0&&s.push({type:"content",value:f,offset:n}),s}),t),t.errors=u}}t.exports={parse:function(e,t){var r=!1,n=new w(function(e){var t=!1,r=[];return e.forEach((function(e){(t=g(e,t))&&"content"===e.type&&r.push(e)})),r}(e));n.parseDelimiters(t);var o=[],i=0;return e.forEach((function(e){r=g(e,r),"content"===e.type&&(e.position=r?"insidetag":"outsidetag"),r&&"content"===e.type?(Array.prototype.push.apply(o,n.parsed[i].map((function(e){return"content"===e.type&&(e.position="insidetag"),e}))),i++):o.push(e)})),o=o.map((function(e,t){return e.lIndex=t,e})),{errors:n.errors,lexed:o}},xmlparse:function(e,t){var r=function(e,t,r){for(var n=0,o=e.length,i=l([t.map((function(e){return{tag:e,text:!0}})),r.map((function(e){return{tag:e,text:!1}}))]).reduce((function(e,t){return e[t.tag]=t.text,e}),{}),a=[];n<o&&-1!==(n=e.indexOf("<",n));){var s=n;n=e.indexOf(">",n);var u=e.slice(s,n+1),c=v(u),p=c.tag,f=c.position,h=i[p];null!=h&&a.push({type:"tag",position:f,text:h,offset:s,value:u,tag:p})}return a}(e,t.text,t.other),n=0,o=r.reduce((function(t,r){var o=e.substr(n,r.offset-n);return o.length>0&&t.push({type:"content",value:o}),n=r.offset+r.value.length,delete r.offset,r.value.length>0&&t.push(r),t}),[]),i=e.substr(n);return i.length>0&&o.push({type:"content",value:i}),o}}},{"./doc-utils":1,"./errors":2}],5:[function(e,t,r){"use strict";function n(e,t){for(var r=-1,n=0,o=e.length;n<o;n++)t[n]>=e[n].length||(-1===r||e[n][t[n]].offset<e[r][t[r]].offset)&&(r=n);if(-1===r)throw new Error("minIndex negative");return r}t.exports=function(e){var t=e.reduce((function(e,t){return e+t.length}),0);e=e.filter((function(e){return e.length>0}));for(var r=new Array(t),o=e.map((function(){return 0})),i=0;i<=t-1;){var a=n(e,o);r[i]=e[a][o[a]],o[a]++,i++}return r}},{}],6:[function(e,t,r){"use strict";function n(){}function o(e){return e}t.exports=function(e){var t={set:n,parse:n,render:n,getTraits:n,optionsTransformer:o,errorsTransformer:o,getRenderedMap:o,postparse:o,on:n,resolve:n};if(Object.keys(t).every((function(t){return!e[t]})))throw new Error("This module cannot be wrapped, because it doesn't define any of the necessary functions");return Object.keys(t).forEach((function(r){e[r]=e[r]||t[r]})),e}},{}],7:[function(e,t,r){"use strict";var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=e("../mergesort"),i=e("../doc-utils"),a=i.getLeft,s=i.getRight,u=e("../module-wrapper"),l=e("../traits").getExpandToDefault,c=e("../errors"),p=c.getUnmatchedLoopException,f=c.getClosingTagNotMatchOpeningTag,h=c.throwLocationInvalid;function d(e){switch(e.location){case"start":return 1;case"end":return-1;default:h(e)}}function m(e){var t=[],r=[];if(0===e.length)return{pairs:r,errors:t};var o=1,i=n(e,1)[0];if("start"===i.part.location)for(var a=1;a<e.length;a++){var s=e[a];if(0===(o+=d(s.part))){var u=m(e.slice(a+1));return s.part.value!==i.part.value&&""!==s.part.value?t.push(f({tags:[i.part,s.part]})):r=[[i,s]],{pairs:r.concat(u.pairs),errors:t.concat(u.errors)}}}var l=i.part;t.push(p({part:l,location:l.location}));var c=m(e.slice(1));return{pairs:c.pairs,errors:t.concat(c.errors)}}var g={name:"ExpandPairTrait",optionsTransformer:function(e,t){return this.expandTags=t.fileTypeConfig.expandTags.concat(t.options.paragraphLoop?t.fileTypeConfig.onParagraphLoop:[]),e},postparse:function(e,t){var r=this,n=t.getTraits,i=t.postparse,u=n("expandPair",e);u=u.map((function(e){return e||[]}));var c=m(u=o(u)),p=c.pairs,f=c.errors,h=p.map((function(t){var n=t[0].part.expandTo;if("auto"===n){var o=l(e,t,r.expandTags);o.error&&f.push(o.error),n=o.value}return n?[a(e,n,t[0].offset),s(e,n,t[1].offset)]:[t[0].offset,t[1].offset]})),d=0,g=void 0;return{postparsed:e.reduce((function(t,r,n){var o=d<p.length&&h[d][0]<=n,a=p[d],s=h[d];if(!o)return t.push(r),t;if(s[0]===n&&(g=[]),a[0].offset!==n&&a[1].offset!==n&&g.push(r),s[1]===n){var u=e[a[0].offset];u.subparsed=i(g,{basePart:u}),delete u.location,delete u.expandTo,t.push(u),d++}return t}),[]),errors:f}}};t.exports=function(){return u(g)}},{"../doc-utils":1,"../errors":2,"../mergesort":5,"../module-wrapper":6,"../traits":16}],8:[function(e,t,r){"use strict";var n=e("../doc-utils"),o=n.mergeObjects,i=n.chunkBy,a=n.last,s=n.isParagraphStart,u=n.isParagraphEnd,l=n.isContent,c=/^-([^\s]+)\s(.+)$/,p=e("../module-wrapper"),f="loop";function h(e){return e.some((function(e){return l(e)}))?0:e.length}var d={name:"LoopModule",prefix:{start:"#",end:"/",dash:"-",inverted:"^"},parse:function(e){var t=f,r="placeholder",n=this.prefix;return e[0]===n.start?{type:r,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!1}:e[0]===n.inverted?{type:r,value:e.substr(1),expandTo:"auto",module:t,location:"start",inverted:!0}:e[0]===n.end?{type:r,value:e.substr(1),module:t,location:"end"}:e[0]===n.dash?{type:r,value:e.replace(c,"$2"),expandTo:e.replace(c,"$1"),module:t,location:"start",inverted:!1}:null},getTraits:function(e,t){if("expandPair"===e)return t.reduce((function(e,t,r){return"placeholder"===t.type&&t.module===f&&e.push({part:t,offset:r}),e}),[])},postparse:function(e,t){var r=t.basePart;if(!function(e){return 0!==e.length&&s(e[0])&&u(a(e))}(e))return e;if(!r||"auto"!==r.expandTo)return e;var n=i(e,(function(e){return s(e)?"start":u(e)?"end":null}));if(n.length<=2)return e;var o=n[0],l=a(n),c=h(o),p=h(l);return 0===c||0===p?e:e.slice(c,e.length-p)},render:function(e,t){if("placeholder"===!e.type||e.module!==f)return null;var r=[],n=[];return t.scopeManager.loopOver(e.value,(function(i,a){var s=t.scopeManager.createSubScopeManager(i,e.value,a),u=t.render(o({},t,{compiled:e.subparsed,tags:{},scopeManager:s}));r=r.concat(u.parts),n=n.concat(u.errors||[])}),e.inverted),{value:r.join(""),errors:n}},resolve:function(e,t){if("placeholder"===!e.type||e.module!==f)return null;var r=t.scopeManager.getValue(e.value),n=[];function i(r,i){var a=t.scopeManager.createSubScopeManager(r,e.value,i);n.push(t.resolve(o(t,{compiled:e.subparsed,tags:{},scopeManager:a})))}return Promise.resolve(r).then((function(r){return t.scopeManager.loopOverValue(r,i,e.inverted),Promise.all(n).then((function(e){return e.map((function(e){return e.resolved}))}))}))}};t.exports=function(){return p(d)}},{"../doc-utils":1,"../module-wrapper":6}],9:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=e("../traits"),i=e("../doc-utils").isContent,a=e("../errors").throwRawTagShouldBeOnlyTextInParagraph,s="rawxml",u=e("../module-wrapper");function l(e){var t=e.part,r=e.left,n=e.right,o=e.postparsed,s=e.index,u=o.slice(r+1,n);return u.forEach((function(e,n){n!==s-r-1&&i(e)&&a({paragraphParts:u,part:t})})),t}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="RawXmlModule",this.prefixMap=[{prefix:"@",skip:1},{prefix:"RTB_",skip:0}],this.getDocxRunProps=function(e){var t,r={};if(null!=e||null!=e||""!=e){var n=e.expanded[0].length;for(t=0;t<n-1;t++){var o=e.expanded[0][t];if("tag"==o.type&&"w:pPr"==o.tag&&"start"==o.position){var i=e.expanded[0][t+1];null!=i&&null!=i&&"content"==i.type&&(r.paragraphLevelProps=i.value)}if("tag"==o.type&&"w:r"==o.tag&&"start"==o.position){var a=e.expanded[0][t+2];null!=a&&null!=a&&"content"==a.type&&(r.runLevelProps=a.value)}}}return r}}return n(e,[{key:"optionsTransformer",value:function(e,t){return this.fileTypeConfig=t.fileTypeConfig,this.overrideFont=e.overrideFont,e}},{key:"parse",value:function(e){var t;for(t=0;t<this.prefixMap.length;t++)if(e.startsWith(this.prefixMap[t].prefix))return{type:"placeholder",value:e.substr(this.prefixMap[t].skip),module:s};return null}},{key:"postparse",value:function(e){return o.expandToOne(e,{moduleName:s,getInner:l,expandTo:this.fileTypeConfig.tagRawXml})}},{key:"render",value:function(e,t){if(e.module!==s)return null;var r=t.scopeManager.getValue(e.value);null==r&&(r=t.nullGetter(e));var n=this.getDocxRunProps(e);if(n.paragraphLevelProps&&n.paragraphLevelProps.indexOf("<w:bidi/>")>-1){for(var o=r.split(/(?:<\/w:p>)/g),i=0;i<o.length;i++)-1==o[i].indexOf("<w:pPr>")?o[i]=o[i].replace("<w:p>","<w:p><w:pPr><w:bidi/></w:pPr>"):o[i]=o[i].replace("</w:pPr>","<w:bidi/></w:pPr>");r=o.join("</w:p>")}if(this.overrideFont&&n.runLevelProps&&n.runLevelProps.indexOf("<w:rFonts")>-1){var a=/<w:rFonts(.*?)\/>/g,u=n.runLevelProps.match(a)[0];for(o=(r=r.replaceAll(a,"")).split(/(?:<\/w:r>)/g),i=0;i<o.length;i++)-1==o[i].indexOf("<w:rPr>")?o[i]=o[i].replace("<w:r>","<w:r><w:rPr>"+u+"</w:rPr>"):o[i]=o[i].replace("</w:rPr>",u+"</w:rPr>");r=o.join("</w:r>")}return{value:r}}}]),e}();t.exports=function(){return u(new c)}},{"../doc-utils":1,"../errors":2,"../module-wrapper":6,"../traits":16}],10:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=e("../module-wrapper"),i=e("../errors").getScopeCompilationError,a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name="Render"}return n(e,[{key:"set",value:function(e){e.compiled&&(this.compiled=e.compiled),null!=e.data&&(this.data=e.data)}},{key:"getRenderedMap",value:function(e){var t=this;return Object.keys(this.compiled).reduce((function(e,r){return e[r]={from:r,data:t.data},e}),e)}},{key:"optionsTransformer",value:function(e,t){return this.parser=t.parser,e}},{key:"postparse",value:function(e){var t=this,r=[];return e.forEach((function(e){if("placeholder"===e.type){var n=e.value;try{t.parser(n)}catch(e){r.push(i({tag:n,rootError:e}))}}})),{postparsed:e,errors:r}}}]),e}();t.exports=function(){return o(new a)}},{"../errors":2,"../module-wrapper":6}],11:[function(e,t,r){"use strict";var n=e("../module-wrapper"),o=e("../doc-utils"),i=o.isTextStart,a=o.isTextEnd;function s(e){return-1!==e.indexOf('xml:space="preserve"')?e:e.substr(0,e.length-1)+' xml:space="preserve">'}var u={name:"SpacePreserveModule",postparse:function(e){var t=[],r=!1,n=0,o=0,u=e.reduce((function(e,u){return i(u)&&"w:t"===u.tag&&(r=!0,o=t.length),r?(n||"placeholder"!==u.type||u.module&&!u.preserveSpace||(n=u.endLindex,t[0].value=s(t[0].value)),t.push(u),a(u)&&(n?u.lIndex>n&&(t[o].value=s(t[o].value),Array.prototype.push.apply(e,t),r=!1,o=0,n=0,t=[]):(Array.prototype.push.apply(e,t),r=!1,o=0,n=0,t=[])),e):(e.push(u),e)}),[]);return Array.prototype.push.apply(u,t),u}};t.exports=function(){return n(u)}},{"../doc-utils":1,"../module-wrapper":6}],12:[function(e,t,r){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=e("./doc-utils"),i=o.wordToUtf8,a=o.concatArrays;var s={postparse:function(e,t){function r(e,r){return t.map((function(t){return t.getTraits(e,r)}))}var o=[];function i(e,s){return t.reduce((function(e,t){var u=t.postparse(e,n({},s,{postparse:i,getTraits:r}));return u.errors?(o=a([o,u.errors]),u.postparsed):u}),e)}return{postparsed:i(e),errors:o}},parse:function(e,t){var r=!1,n="",o=void 0,a=[];return e.reduce((function(e,s){if("delimiter"===s.type){if(r="start"===s.position,"end"===s.position){var u=s.lIndex;n=i(n),e=function(e,t,r,n,o){for(var i=void 0,a=0,s=e.length;a<s;a++)if(i=e[a].parse(t))return i.offset=n,i.endLindex=o,r.push(i),r;return r.push({type:"placeholder",value:t,offset:n,endLindex:o}),r}(t,n,e,o,u),o=null,Array.prototype.push.apply(e,a),a=[]}return"start"===s.position&&(a=[],o=s.offset),n="",e}return r?"content"!==s.type||"insidetag"!==s.position?(a.push(s),e):(n+=s.value,e):(e.push(s),e)}),[])}};t.exports=s},{"./doc-utils":1}],13:[function(e,t,r){"use strict";var n=e("./doc-utils"),o=n.utf8ToWord,i=n.concatArrays,a=n.hasCorruptCharacters,s=e("./errors"),u=s.throwUnimplementedTagType,l=s.throwCorruptCharacters;t.exports=function(e){var t=e.compiled,r=e.scopeManager,n=e.nullGetter,s=[],c=t.map((function(t,c){t.lIndex=c;var p=function(e,t){for(var r=void 0,n=0,o=t.modules.length;n<o;n++)if(r=t.modules[n].render(e,t))return r;return!1}(t,e);if(p)return p.errors&&(s=i([s,p.errors])),p.value;if("placeholder"===t.type){var f=r.getValue(t.value);return null==f&&(f=n(t)),a(f)&&l({tag:t.value,value:f}),o(f)}if("content"===t.type||"tag"===t.type)return t.value;u(t)}));return{errors:s,parts:c}}},{"./doc-utils":1,"./errors":2}],14:[function(e,t,r){"use strict";t.exports=function(e){var t=[],r=e.compiled,n=e.scopeManager,o=e.nullGetter;e.resolved=t;var i=[];return Promise.all(r.map((function(r){var i=function(e,t){for(var r=void 0,n=0,o=t.modules.length;n<o;n++)if(r=t.modules[n].resolve(e,t))return r;return!1}(r,e);return i?i.then((function(e){t.push({tag:r.value,value:e})})):"placeholder"===r.type?n.getValueAsync(r.value).then((function(e){return null==e&&(e=o(r)),t.push({tag:r.value,value:e}),e})):void 0})).filter((function(e){return e}))).then((function(){return{errors:i,resolved:t}}))}},{}],15:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=e("./errors").getScopeParserExecutionError,i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scopePath=t.scopePath,this.scopePathItem=t.scopePathItem,this.scopeList=t.scopeList,this.parser=t.parser,this.resolved=t.resolved}return n(e,[{key:"loopOver",value:function(e,t,r){return r=r||!1,this.loopOverValue(this.getValue(e),t,r)}},{key:"functorIfInverted",value:function(e,t,r,n){e&&t(r,n)}},{key:"isValueFalsy",value:function(e,t){return null==e||!e||"[object Array]"===t&&0===e.length}},{key:"loopOverValue",value:function(e,t,r){var n=Object.prototype.toString.call(e),o=this.scopeList[this.num];if(this.isValueFalsy(e,n))return this.functorIfInverted(r,t,o,0);if("[object Array]"!==n)return"[object Object]"===n?this.functorIfInverted(!r,t,e,0):this.functorIfInverted(!r,t,o,0);for(var i,a=0;a<e.length;a++)i=e[a],this.functorIfInverted(!r,t,i,a)}},{key:"getValue",value:function(e,t){var r=this;this.num=null==t?this.scopeList.length-1:t;var n=this.scopeList[this.num];if(this.resolved){var i=this.resolved;return this.scopePath.forEach((function(e,t){i=(i=i.find((function(t){if(t.tag===e)return!0}))).value[r.scopePathItem[t]]})),i=i.find((function(t){if(t.tag===e)return!0})).value}var a=void 0,s=this.parser(e,{scopePath:this.scopePath});try{a=s.get(n,{num:this.num,scopeList:this.scopeList})}catch(t){throw o({tag:e,scope:n,error:t})}return null==a&&this.num>0?this.getValue(e,this.num-1):a}},{key:"getValueAsync",value:function(e,t){var r=this;this.num=null==t?this.scopeList.length-1:t;var n=this.scopeList[this.num],i=this.parser(e,{scopePath:this.scopePath});return Promise.resolve(i.get(n,{num:this.num,scopeList:this.scopeList})).catch((function(t){throw o({tag:e,scope:n,error:t})})).then((function(t){return null==t&&r.num>0?r.getValueAsync(e,r.num-1):t}))}},{key:"createSubScopeManager",value:function(t,r,n){return new e({resolved:this.resolved,parser:this.parser,scopeList:this.scopeList.concat(t),scopePath:this.scopePath.concat(r),scopePathItem:this.scopePathItem.concat(n)})}}]),e}();t.exports=function(e){return e.scopePath=[],e.scopePathItem=[],e.scopeList=[e.tags],new i(e)}},{"./errors":2}],16:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./doc-utils"),i=o.getRight,a=o.getLeft,s=o.concatArrays,u=o.chunkBy,l=o.isTagStart,c=o.isTagEnd,p=o.isContent,f=o.last,h=e("./errors"),d=h.XTTemplateError,m=h.throwRawTagNotInParagraph,g=h.getLoopPositionProducesInvalidXMLError;function v(e,t){if(0===e.length)return!1;var r=e[e.length-1].tag.substr(1),n=t.substr(2,t.length-3);return 0===r.indexOf(n)}function y(e,t){return e.push({tag:t}),e}t.exports={expandToOne:function(e,t){var r=[];return e.errors&&(r=e.errors,e=e.postparsed),e.reduce((function(e,r){return"placeholder"===r.type&&r.module===t.moduleName&&e.push(r),e}),[]).forEach((function(n){try{e=function(e,t,r){var n=e.expandTo||r.expandTo,o=t.indexOf(e);if(!n)return t;var u=void 0,l=void 0;try{u=i(t,n,o),l=a(t,n,o)}catch(r){throw r instanceof d&&m({part:e,rootError:r,postparsed:t,expandTo:n,index:o}),r}var c=t.slice(l,o),p=t.slice(o+1,u+1),f=r.getInner({index:o,part:e,leftParts:c,rightParts:p,left:l,right:u,postparsed:t});return f.length||(f.expanded=[c,p],f=[f]),s([t.slice(0,l),f,t.slice(u+1)])}(n,e,t)}catch(e){if(!(e instanceof d))throw e;r.push(e)}})),{postparsed:e,errors:r}},getExpandToDefault:function(e,t,r){var o=function(e){for(var t,r=e.filter((function(e){return"tag"===e.type})),n=[],o=0;o<r.length;o++)"/"===(t=r[o].value)[1]?v(n,t)?n.pop():n=y(n,t):"/"!==t[t.length-2]&&(n=y(n,t));return n}(e.slice(t[0].offset,t[1].offset));if(o.filter((function(e){return"/"===e.tag[1]})).length!==o.filter((function(e){var t=e.tag;return"/"!==t[1]&&"/"!==t[t.length-2]})).length)return{error:g({tag:t[0].part.value})};for(var s=function(n,s){var h=r[n],d=h.contains,m=h.expand,g=h.onlyTextInTag;if(function(e,t){for(var r=0;r<t.length;r++)if(0===t[r].tag.indexOf("<"+e))return!0;return!1}(d,o)){if(g){var v=a(e,d,t[0].offset),y=i(e,d,t[1].offset),x=u(e.slice(v,y),(function(e){return l(d,e)?"start":c(d,e)?"end":null}));if(x.length<=2)return"continue";var w=x[0],T=f(x),b=w.filter(p),N=T.filter(p);if(1!==b.length||1!==N.length)return"continue"}return{v:{value:m}}}},h=0,d=r.length;h<d;h++){var m=s(h);if("continue"!==m&&"object"===(void 0===m?"undefined":n(m)))return m.v}return!1}}},{"./doc-utils":1,"./errors":2}],17:[function(e,t,r){"use strict";var n=e("./doc-utils").pregMatchAll;t.exports=function(e,t){var r={};r.content=e,r.tagsXmlArray=t,r.tagsXmlArrayJoined=r.tagsXmlArray.join("|");var o=new RegExp("(?:(<(?:"+r.tagsXmlArrayJoined+")[^>]*>)([^<>]*)</(?:"+r.tagsXmlArrayJoined+")>)|(<(?:"+r.tagsXmlArrayJoined+")[^>]*/>)","g");return r.matches=n(o,r.content),function(e){function t(){var t={array:Array.prototype.slice.call(arguments)};t.array.shift();var r=t.array[0]+t.array[1];t.array.unshift(r),t.array.pop();var n=t.array.pop();t.offset=n,t.first=!0,e.matches.unshift(t)}-1===e.content.indexOf("<")&&-1===e.content.indexOf(">")&&e.content.replace(/^()([^<>]*)$/,t);var r=new RegExp("^()([^<]+)</(?:"+e.tagsXmlArrayJoined+")>");return e.content.replace(r,t),r=new RegExp("(<(?:"+e.tagsXmlArrayJoined+")[^>]*>)([^>]+)$"),e.content.replace(r,(function(){var t={array:Array.prototype.slice.call(arguments)};t.array.pop();var r=t.array.pop();t.offset=r,t.last=!0,-1===t.array[0].indexOf("/>")&&e.matches.push(t)})),e}(r)}},{"./doc-utils":1}],18:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var i=e("./doc-utils"),a=i.wordToUtf8,s=i.convertSpaces,u=i.defaults,l=e("./scope-manager"),c=e("./xml-matcher"),p=e("./errors"),f=p.throwMultiError,h=p.throwContentMustBeString,d=e("./lexer"),m=e("./parser.js"),g=e("./render.js"),v=e("./resolve.js");t.exports=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.fromJson(r),this.setModules({inspect:{filePath:this.filePath}}),this.load(t)}return o(e,[{key:"load",value:function(e){"string"!=typeof e&&h(void 0===e?"undefined":n(e)),this.content=e}},{key:"setTags",value:function(e){return this.tags=null!=e?e:{},this.scopeManager=l({tags:this.tags,parser:this.parser}),this}},{key:"resolveTags",value:function(e){var t=this;this.tags=null!=e?e:{},this.scopeManager=l({tags:this.tags,parser:this.parser});var r={compiled:this.postparsed,tags:this.tags,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath,resolve:v};return r.scopeManager=l(r),v(r).then((function(e){var r=e.resolved;return Promise.all(r.map((function(e){return Promise.resolve(e)}))).then((function(e){return t.resolved=e}))}))}},{key:"fromJson",value:function(e){this.filePath=e.filePath,this.modules=e.modules,this.fileTypeConfig=e.fileTypeConfig,Object.keys(u).map((function(t){this[t]=null!=e[t]?e[t]:u[t]}),this)}},{key:"getFullText",value:function(){return e=this.content,t=this.fileTypeConfig.tagsXmlTextArray,r=c(e,t).matches.map((function(e){return e.array[2]})),a(s(r.join("")));var e,t,r}},{key:"setModules",value:function(e){this.modules.forEach((function(t){t.set(e)}))}},{key:"parse",value:function(){var e,t=[],r="{{IMG_",n="}}",o=0,i=[];if(-1===this.filePath.indexOf("ppt")&&this.content.indexOf(r)>-1){for(;(e=this.content.indexOf(r,o))>-1;)i.push(e),o=e+6+2;for(var a=0;a<i.length;a++){var s=i[a],u=this.content.indexOf(n,s);this.content=this.content.slice(0,u+2)+'</w:t><w:t xml:space="preserve">'+this.content.slice(u+2)}}this.xmllexed=d.xmlparse(this.content,{text:this.fileTypeConfig.tagsXmlTextArray,other:this.fileTypeConfig.tagsXmlLexedArray}),this.setModules({inspect:{xmllexed:this.xmllexed}});var l=d.parse(this.xmllexed,this.delimiters),c=l.lexed,p=l.errors;t=t.concat(p),this.lexed=c,this.setModules({inspect:{lexed:this.lexed}}),this.parsed=m.parse(this.lexed,this.modules),this.setModules({inspect:{parsed:this.parsed}});var f=m.postparse(this.parsed,this.modules),h=f.postparsed,g=f.errors;return this.postparsed=h,this.setModules({inspect:{postparsed:this.postparsed}}),t=t.concat(g),this.errorChecker(t),this}},{key:"errorChecker",value:function(e){var t=this;e.length&&(this.modules.forEach((function(t){e=t.errorsTransformer(e)})),e.forEach((function(e){e.properties.file=t.filePath})),f(e))}},{key:"render",value:function(e){this.filePath=e;var t={compiled:this.postparsed,tags:this.tags,resolved:this.resolved,modules:this.modules,parser:this.parser,nullGetter:this.nullGetter,filePath:this.filePath,render:g};t.scopeManager=l(t);var r=g(t),n=r.errors,o=r.parts;return this.errorChecker(n),this.content=o.join(""),this.setModules({inspect:{content:this.content}}),this}}]),e}()},{"./doc-utils":1,"./errors":2,"./lexer":4,"./parser.js":12,"./render.js":13,"./resolve.js":14,"./scope-manager":15,"./xml-matcher":17}],19:[function(e,t,r){function n(e){this.options=e||{locator:{}}}function o(){this.cdata=!1}function i(e,t){t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber}function a(e){if(e)return"\n@"+(e.systemId||"")+"#[line:"+e.lineNumber+",col:"+e.columnNumber+"]"}function s(e,t,r){return"string"==typeof e?e.substr(t,r):e.length>=t+r||t?new java.lang.String(e,t,r)+"":e}function u(e,t){e.currentElement?e.currentElement.appendChild(t):e.doc.appendChild(t)}n.prototype.parseFromString=function(e,t){var r=this.options,n=new l,i=r.domBuilder||new o,s=r.errorHandler,u=r.locator,c=r.xmlns||{},p={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return u&&i.setDocumentLocator(u),n.errorHandler=function(e,t,r){if(!e){if(t instanceof o)return t;e=t}var n={},i=e instanceof Function;function s(t){var o=e[t];!o&&i&&(o=2==e.length?function(r){e(t,r)}:e),n[t]=o&&function(e){o("[xmldom "+t+"]\t"+e+a(r))}||function(){}}return r=r||{},s("warning"),s("error"),s("fatalError"),n}(s,i,u),n.domBuilder=r.domBuilder||i,/\/x?html?$/.test(t)&&(p.nbsp=" ",p.copy="©",c[""]="http://www.w3.org/1999/xhtml"),c.xml=c.xml||"http://www.w3.org/XML/1998/namespace",e?n.parse(e,c,p):n.errorHandler.error("invalid doc source"),i.doc},o.prototype={startDocument:function(){this.doc=(new c).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(e,t,r,n){var o=this.doc,a=o.createElementNS(e,r||t),s=n.length;u(this,a),this.currentElement=a,this.locator&&i(this.locator,a);for(var l=0;l<s;l++){e=n.getURI(l);var c=n.getValue(l),p=(r=n.getQName(l),o.createAttributeNS(e,r));this.locator&&i(n.getLocator(l),p),p.value=p.nodeValue=c,a.setAttributeNode(p)}},endElement:function(e,t,r){var n=this.currentElement;n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(e,t){},endPrefixMapping:function(e){},processingInstruction:function(e,t){var r=this.doc.createProcessingInstruction(e,t);this.locator&&i(this.locator,r),u(this,r)},ignorableWhitespace:function(e,t,r){},characters:function(e,t,r){if(e=s.apply(this,arguments)){if(this.cdata)var n=this.doc.createCDATASection(e);else n=this.doc.createTextNode(e);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(e)&&this.doc.appendChild(n),this.locator&&i(this.locator,n)}},skippedEntity:function(e){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(e){(this.locator=e)&&(e.lineNumber=0)},comment:function(e,t,r){e=s.apply(this,arguments);var n=this.doc.createComment(e);this.locator&&i(this.locator,n),u(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(e,t,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var o=n.createDocumentType(e,t,r);this.locator&&i(this.locator,o),u(this,o)}},warning:function(e){console.warn("[xmldom warning]\t"+e,a(this.locator))},error:function(e){console.error("[xmldom error]\t"+e,a(this.locator))},fatalError:function(e){throw console.error("[xmldom fatalError]\t"+e,a(this.locator)),e}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,(function(e){o.prototype[e]=function(){return null}}));var l=e("./sax").XMLReader,c=r.DOMImplementation=e("./dom").DOMImplementation;r.XMLSerializer=e("./dom").XMLSerializer,r.DOMParser=n},{"./dom":20,"./sax":21}],20:[function(e,t,r){function n(e,t){for(var r in e)t[r]=e[r]}function o(e,t){var r=e.prototype;if(Object.create){var o=Object.create(t.prototype);r.__proto__=o}if(!(r instanceof t)){function i(){}i.prototype=t.prototype,n(r,i=new i),e.prototype=r=i}r.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),r.constructor=e)}var i="http://www.w3.org/1999/xhtml",a={},s=a.ELEMENT_NODE=1,u=a.ATTRIBUTE_NODE=2,l=a.TEXT_NODE=3,c=a.CDATA_SECTION_NODE=4,p=a.ENTITY_REFERENCE_NODE=5,f=a.ENTITY_NODE=6,h=a.PROCESSING_INSTRUCTION_NODE=7,d=a.COMMENT_NODE=8,m=a.DOCUMENT_NODE=9,g=a.DOCUMENT_TYPE_NODE=10,v=a.DOCUMENT_FRAGMENT_NODE=11,y=a.NOTATION_NODE=12,x={},w={},T=(x.INDEX_SIZE_ERR=(w[1]="Index size error",1),x.DOMSTRING_SIZE_ERR=(w[2]="DOMString size error",2),x.HIERARCHY_REQUEST_ERR=(w[3]="Hierarchy request error",3)),b=(x.WRONG_DOCUMENT_ERR=(w[4]="Wrong document",4),x.INVALID_CHARACTER_ERR=(w[5]="Invalid character",5),x.NO_DATA_ALLOWED_ERR=(w[6]="No data allowed",6),x.NO_MODIFICATION_ALLOWED_ERR=(w[7]="No modification allowed",7),x.NOT_FOUND_ERR=(w[8]="Not found",8)),N=(x.NOT_SUPPORTED_ERR=(w[9]="Not supported",9),x.INUSE_ATTRIBUTE_ERR=(w[10]="Attribute in use",10));x.INVALID_STATE_ERR=(w[11]="Invalid state",11),x.SYNTAX_ERR=(w[12]="Syntax error",12),x.INVALID_MODIFICATION_ERR=(w[13]="Invalid modification",13),x.NAMESPACE_ERR=(w[14]="Invalid namespace",14),x.INVALID_ACCESS_ERR=(w[15]="Invalid access",15);function E(e,t){if(t instanceof Error)var r=t;else r=this,Error.call(this,w[e]),this.message=w[e],Error.captureStackTrace&&Error.captureStackTrace(this,E);return r.code=e,t&&(this.message=this.message+": "+t),r}function C(){}function S(e,t){this._node=e,this._refresh=t,D(this)}function D(e){var t=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=t){var r=e._refresh(e._node);ie(e,"length",r.length),n(r,e),e._inc=t}}function _(){}function I(e,t){for(var r=e.length;r--;)if(e[r]===t)return r}function P(e,t,r,n){if(n?t[I(t,n)]=r:t[t.length++]=r,e){r.ownerElement=e;var o=e.ownerDocument;o&&(n&&F(o,e,n),function(e,t,r){e&&e._inc++;var n=r.namespaceURI;"http://www.w3.org/2000/xmlns/"==n&&(t._nsMap[r.prefix?r.localName:""]=r.value)}(o,e,r))}}function O(e,t,r){var n=I(t,r);if(!(n>=0))throw E(b,new Error(e.tagName+"@"+r));for(var o=t.length-1;n<o;)t[n]=t[++n];if(t.length=o,e){var i=e.ownerDocument;i&&(F(i,e,r),r.ownerElement=null)}}function A(e){if(this._features={},e)for(var t in e)this._features=e[t]}function M(){}function k(e){return("<"==e?"&lt;":">"==e&&"&gt;")||"&"==e&&"&amp;"||'"'==e&&"&quot;"||"&#"+e.charCodeAt()+";"}function R(e,t){if(t(e))return!0;if(e=e.firstChild)do{if(R(e,t))return!0}while(e=e.nextSibling)}function L(){}function F(e,t,r,n){e&&e._inc++,"http://www.w3.org/2000/xmlns/"==r.namespaceURI&&delete t._nsMap[r.prefix?r.localName:""]}function j(e,t,r){if(e&&e._inc){e._inc++;var n=t.childNodes;if(r)n[n.length++]=r;else{for(var o=t.firstChild,i=0;o;)n[i++]=o,o=o.nextSibling;n.length=i}}}function X(e,t){var r=t.previousSibling,n=t.nextSibling;return r?r.nextSibling=n:e.firstChild=n,n?n.previousSibling=r:e.lastChild=r,j(e.ownerDocument,e),t}function U(e,t,r){var n=t.parentNode;if(n&&n.removeChild(t),t.nodeType===v){var o=t.firstChild;if(null==o)return t;var i=t.lastChild}else o=i=t;var a=r?r.previousSibling:e.lastChild;o.previousSibling=a,i.nextSibling=r,a?a.nextSibling=o:e.firstChild=o,null==r?e.lastChild=i:r.previousSibling=i;do{o.parentNode=e}while(o!==i&&(o=o.nextSibling));return j(e.ownerDocument||e,e),t.nodeType==v&&(t.firstChild=t.lastChild=null),t}function z(){this._nsMap={}}function B(){}function V(){}function $(){}function q(){}function G(){}function H(){}function W(){}function J(){}function Z(){}function Y(){}function Q(){}function K(){}function ee(e,t){var r=[],n=9==this.nodeType?this.documentElement:this,o=n.prefix,i=n.namespaceURI;if(i&&null==o&&null==(o=n.lookupPrefix(i)))var a=[{namespace:i,prefix:null}];return re(this,r,e,t,a),r.join("")}function te(e,t,r){var n=e.prefix||"",o=e.namespaceURI;if(!n&&!o)return!1;if("xml"===n&&"http://www.w3.org/XML/1998/namespace"===o||"http://www.w3.org/2000/xmlns/"==o)return!1;for(var i=r.length;i--;){var a=r[i];if(a.prefix==n)return a.namespace!=o}return!0}function re(e,t,r,n,o){if(n){if(!(e=n(e)))return;if("string"==typeof e)return void t.push(e)}switch(e.nodeType){case s:o||(o=[]);o.length;var a=e.attributes,f=a.length,y=e.firstChild,x=e.tagName;r=i===e.namespaceURI||r,t.push("<",x);for(var w=0;w<f;w++){"xmlns"==(T=a.item(w)).prefix?o.push({prefix:T.localName,namespace:T.value}):"xmlns"==T.nodeName&&o.push({prefix:"",namespace:T.value})}for(w=0;w<f;w++){var T;if(te(T=a.item(w),0,o)){var b=T.prefix||"",N=T.namespaceURI,E=b?" xmlns:"+b:" xmlns";t.push(E,'="',N,'"'),o.push({prefix:b,namespace:N})}re(T,t,r,n,o)}if(te(e,0,o)){b=e.prefix||"",N=e.namespaceURI,E=b?" xmlns:"+b:" xmlns";t.push(E,'="',N,'"'),o.push({prefix:b,namespace:N})}if(y||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(x)){if(t.push(">"),r&&/^script$/i.test(x))for(;y;)y.data?t.push(y.data):re(y,t,r,n,o),y=y.nextSibling;else for(;y;)re(y,t,r,n,o),y=y.nextSibling;t.push("</",x,">")}else t.push("/>");return;case m:case v:for(y=e.firstChild;y;)re(y,t,r,n,o),y=y.nextSibling;return;case u:return t.push(" ",e.name,'="',e.value.replace(/[<&"]/g,k),'"');case l:return t.push(e.data.replace(/[<&]/g,k));case c:return t.push("<![CDATA[",e.data,"]]>");case d:return t.push("\x3c!--",e.data,"--\x3e");case g:var C=e.publicId,S=e.systemId;if(t.push("<!DOCTYPE ",e.name),C)t.push(' PUBLIC "',C),S&&"."!=S&&t.push('" "',S),t.push('">');else if(S&&"."!=S)t.push(' SYSTEM "',S,'">');else{var D=e.internalSubset;D&&t.push(" [",D,"]"),t.push(">")}return;case h:return t.push("<?",e.target," ",e.data,"?>");case p:return t.push("&",e.nodeName,";");default:t.push("??",e.nodeName)}}function ne(e,t,r){var n;switch(t.nodeType){case s:(n=t.cloneNode(!1)).ownerDocument=e;case v:break;case u:r=!0}if(n||(n=t.cloneNode(!1)),n.ownerDocument=e,n.parentNode=null,r)for(var o=t.firstChild;o;)n.appendChild(ne(e,o,r)),o=o.nextSibling;return n}function oe(e,t,r){var n=new t.constructor;for(var o in t){var i=t[o];"object"!=typeof i&&i!=n[o]&&(n[o]=i)}switch(t.childNodes&&(n.childNodes=new C),n.ownerDocument=e,n.nodeType){case s:var a=t.attributes,l=n.attributes=new _,c=a.length;l._ownerElement=n;for(var p=0;p<c;p++)n.setAttributeNode(oe(e,a.item(p),!0));break;case u:r=!0}if(r)for(var f=t.firstChild;f;)n.appendChild(oe(e,f,r)),f=f.nextSibling;return n}function ie(e,t,r){e[t]=r}E.prototype=Error.prototype,n(x,E),C.prototype={length:0,item:function(e){return this[e]||null},toString:function(e,t){for(var r=[],n=0;n<this.length;n++)re(this[n],r,e,t);return r.join("")}},S.prototype.item=function(e){return D(this),this[e]},o(S,C),_.prototype={length:0,item:C.prototype.item,getNamedItem:function(e){for(var t=this.length;t--;){var r=this[t];if(r.nodeName==e)return r}},setNamedItem:function(e){var t=e.ownerElement;if(t&&t!=this._ownerElement)throw new E(N);var r=this.getNamedItem(e.nodeName);return P(this._ownerElement,this,e,r),r},setNamedItemNS:function(e){var t,r=e.ownerElement;if(r&&r!=this._ownerElement)throw new E(N);return t=this.getNamedItemNS(e.namespaceURI,e.localName),P(this._ownerElement,this,e,t),t},removeNamedItem:function(e){var t=this.getNamedItem(e);return O(this._ownerElement,this,t),t},removeNamedItemNS:function(e,t){var r=this.getNamedItemNS(e,t);return O(this._ownerElement,this,r),r},getNamedItemNS:function(e,t){for(var r=this.length;r--;){var n=this[r];if(n.localName==t&&n.namespaceURI==e)return n}return null}},A.prototype={hasFeature:function(e,t){var r=this._features[e.toLowerCase()];return!(!r||t&&!(t in r))},createDocument:function(e,t,r){var n=new L;if(n.implementation=this,n.childNodes=new C,n.doctype=r,r&&n.appendChild(r),t){var o=n.createElementNS(e,t);n.appendChild(o)}return n},createDocumentType:function(e,t,r){var n=new H;return n.name=e,n.nodeName=e,n.publicId=t,n.systemId=r,n}},M.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(e,t){return U(this,e,t)},replaceChild:function(e,t){this.insertBefore(e,t),t&&this.removeChild(t)},removeChild:function(e){return X(this,e)},appendChild:function(e){return this.insertBefore(e,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(e){return oe(this.ownerDocument||this,this,e)},normalize:function(){for(var e=this.firstChild;e;){var t=e.nextSibling;t&&t.nodeType==l&&e.nodeType==l?(this.removeChild(t),e.appendData(t.data)):(e.normalize(),e=t)}},isSupported:function(e,t){return this.ownerDocument.implementation.hasFeature(e,t)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(e){for(var t=this;t;){var r=t._nsMap;if(r)for(var n in r)if(r[n]==e)return n;t=t.nodeType==u?t.ownerDocument:t.parentNode}return null},lookupNamespaceURI:function(e){for(var t=this;t;){var r=t._nsMap;if(r&&e in r)return r[e];t=t.nodeType==u?t.ownerDocument:t.parentNode}return null},isDefaultNamespace:function(e){return null==this.lookupPrefix(e)}},n(a,M),n(a,M.prototype),L.prototype={nodeName:"#document",nodeType:m,doctype:null,documentElement:null,_inc:1,insertBefore:function(e,t){if(e.nodeType==v){for(var r=e.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,t),r=n}return e}return null==this.documentElement&&e.nodeType==s&&(this.documentElement=e),U(this,e,t),e.ownerDocument=this,e},removeChild:function(e){return this.documentElement==e&&(this.documentElement=null),X(this,e)},importNode:function(e,t){return ne(this,e,t)},getElementById:function(e){var t=null;return R(this.documentElement,(function(r){if(r.nodeType==s&&r.getAttribute("id")==e)return t=r,!0})),t},createElement:function(e){var t=new z;return t.ownerDocument=this,t.nodeName=e,t.tagName=e,t.childNodes=new C,(t.attributes=new _)._ownerElement=t,t},createDocumentFragment:function(){var e=new Y;return e.ownerDocument=this,e.childNodes=new C,e},createTextNode:function(e){var t=new $;return t.ownerDocument=this,t.appendData(e),t},createComment:function(e){var t=new q;return t.ownerDocument=this,t.appendData(e),t},createCDATASection:function(e){var t=new G;return t.ownerDocument=this,t.appendData(e),t},createProcessingInstruction:function(e,t){var r=new Q;return r.ownerDocument=this,r.tagName=r.target=e,r.nodeValue=r.data=t,r},createAttribute:function(e){var t=new B;return t.ownerDocument=this,t.name=e,t.nodeName=e,t.localName=e,t.specified=!0,t},createEntityReference:function(e){var t=new Z;return t.ownerDocument=this,t.nodeName=e,t},createElementNS:function(e,t){var r=new z,n=t.split(":"),o=r.attributes=new _;return r.childNodes=new C,r.ownerDocument=this,r.nodeName=t,r.tagName=t,r.namespaceURI=e,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,o._ownerElement=r,r},createAttributeNS:function(e,t){var r=new B,n=t.split(":");return r.ownerDocument=this,r.nodeName=t,r.name=t,r.namespaceURI=e,r.specified=!0,2==n.length?(r.prefix=n[0],r.localName=n[1]):r.localName=t,r}},o(L,M),z.prototype={nodeType:s,hasAttribute:function(e){return null!=this.getAttributeNode(e)},getAttribute:function(e){var t=this.getAttributeNode(e);return t&&t.value||""},getAttributeNode:function(e){return this.attributes.getNamedItem(e)},setAttribute:function(e,t){var r=this.ownerDocument.createAttribute(e);r.value=r.nodeValue=""+t,this.setAttributeNode(r)},removeAttribute:function(e){var t=this.getAttributeNode(e);t&&this.removeAttributeNode(t)},appendChild:function(e){return e.nodeType===v?this.insertBefore(e,null):function(e,t){var r=t.parentNode;if(r){var n=e.lastChild;r.removeChild(t),n=e.lastChild}return n=e.lastChild,t.parentNode=e,t.previousSibling=n,t.nextSibling=null,n?n.nextSibling=t:e.firstChild=t,e.lastChild=t,j(e.ownerDocument,e,t),t}(this,e)},setAttributeNode:function(e){return this.attributes.setNamedItem(e)},setAttributeNodeNS:function(e){return this.attributes.setNamedItemNS(e)},removeAttributeNode:function(e){return this.attributes.removeNamedItem(e.nodeName)},removeAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);r&&this.removeAttributeNode(r)},hasAttributeNS:function(e,t){return null!=this.getAttributeNodeNS(e,t)},getAttributeNS:function(e,t){var r=this.getAttributeNodeNS(e,t);return r&&r.value||""},setAttributeNS:function(e,t,r){var n=this.ownerDocument.createAttributeNS(e,t);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(e,t){return this.attributes.getNamedItemNS(e,t)},getElementsByTagName:function(e){return new S(this,(function(t){var r=[];return R(t,(function(n){n===t||n.nodeType!=s||"*"!==e&&n.tagName!=e||r.push(n)})),r}))},getElementsByTagNameNS:function(e,t){return new S(this,(function(r){var n=[];return R(r,(function(o){o===r||o.nodeType!==s||"*"!==e&&o.namespaceURI!==e||"*"!==t&&o.localName!=t||n.push(o)})),n}))}},L.prototype.getElementsByTagName=z.prototype.getElementsByTagName,L.prototype.getElementsByTagNameNS=z.prototype.getElementsByTagNameNS,o(z,M),B.prototype.nodeType=u,o(B,M),V.prototype={data:"",substringData:function(e,t){return this.data.substring(e,e+t)},appendData:function(e){e=this.data+e,this.nodeValue=this.data=e,this.length=e.length},insertData:function(e,t){this.replaceData(e,0,t)},appendChild:function(e){throw new Error(w[T])},deleteData:function(e,t){this.replaceData(e,t,"")},replaceData:function(e,t,r){r=this.data.substring(0,e)+r+this.data.substring(e+t),this.nodeValue=this.data=r,this.length=r.length}},o(V,M),$.prototype={nodeName:"#text",nodeType:l,splitText:function(e){var t=this.data,r=t.substring(e);t=t.substring(0,e),this.data=this.nodeValue=t,this.length=t.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},o($,V),q.prototype={nodeName:"#comment",nodeType:d},o(q,V),G.prototype={nodeName:"#cdata-section",nodeType:c},o(G,V),H.prototype.nodeType=g,o(H,M),W.prototype.nodeType=y,o(W,M),J.prototype.nodeType=f,o(J,M),Z.prototype.nodeType=p,o(Z,M),Y.prototype.nodeName="#document-fragment",Y.prototype.nodeType=v,o(Y,M),Q.prototype.nodeType=h,o(Q,M),K.prototype.serializeToString=function(e,t,r){return ee.call(e,t,r)},M.prototype.toString=ee;try{if(Object.defineProperty){function ae(e){switch(e.nodeType){case s:case v:var t=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&t.push(ae(e)),e=e.nextSibling;return t.join("");default:return e.nodeValue}}Object.defineProperty(S.prototype,"length",{get:function(){return D(this),this.$$length}}),Object.defineProperty(M.prototype,"textContent",{get:function(){return ae(this)},set:function(e){switch(this.nodeType){case s:case v:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),ie=function(e,t,r){e["$$"+t]=r}}}catch(se){}r.DOMImplementation=A,r.XMLSerializer=K},{}],21:[function(e,t,r){var n=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,o=new RegExp("[\\-\\.0-9"+n.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),i=new RegExp("^"+n.source+o.source+"*(?::"+n.source+o.source+"*)?$"),a=0,s=1,u=2,l=3,c=4,p=5,f=6,h=7;function d(){}function m(e,t){return t.lineNumber=e.lineNumber,t.columnNumber=e.columnNumber,t}function g(e,t,r,n,o,i){for(var d,m=++t,g=a;;){var v=e.charAt(m);switch(v){case"=":if(g===s)d=e.slice(t,m),g=l;else{if(g!==u)throw new Error("attribute equal must after attrName");g=l}break;case"'":case'"':if(g===l||g===s){if(g===s&&(i.warning('attribute value must after "="'),d=e.slice(t,m)),t=m+1,!((m=e.indexOf(v,t))>0))throw new Error("attribute value no end '"+v+"' match");y=e.slice(t,m).replace(/&#?\w+;/g,o),r.add(d,y,t-1),g=p}else{if(g!=c)throw new Error('attribute value must after "="');y=e.slice(t,m).replace(/&#?\w+;/g,o),r.add(d,y,t),i.warning('attribute "'+d+'" missed start quot('+v+")!!"),t=m+1,g=p}break;case"/":switch(g){case a:r.setTagName(e.slice(t,m));case p:case f:case h:g=h,r.closed=!0;case c:case s:case u:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return i.error("unexpected end of input"),g==a&&r.setTagName(e.slice(t,m)),m;case">":switch(g){case a:r.setTagName(e.slice(t,m));case p:case f:case h:break;case c:case s:"/"===(y=e.slice(t,m)).slice(-1)&&(r.closed=!0,y=y.slice(0,-1));case u:g===u&&(y=d),g==c?(i.warning('attribute "'+y+'" missed quot(")!!'),r.add(d,y.replace(/&#?\w+;/g,o),t)):("http://www.w3.org/1999/xhtml"===n[""]&&y.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+y+'" missed value!! "'+y+'" instead!!'),r.add(y,y,t));break;case l:throw new Error("attribute value missed!!")}return m;case"":v=" ";default:if(v<=" ")switch(g){case a:r.setTagName(e.slice(t,m)),g=f;break;case s:d=e.slice(t,m),g=u;break;case c:var y=e.slice(t,m).replace(/&#?\w+;/g,o);i.warning('attribute "'+y+'" missed quot(")!!'),r.add(d,y,t);case p:g=f}else switch(g){case u:r.tagName;"http://www.w3.org/1999/xhtml"===n[""]&&d.match(/^(?:disabled|checked|selected)$/i)||i.warning('attribute "'+d+'" missed value!! "'+d+'" instead2!!'),r.add(d,d,t),t=m,g=s;break;case p:i.warning('attribute space is required"'+d+'"!!');case f:g=s,t=m;break;case l:g=c,t=m;break;case h:throw new Error("elements closed character '/' and '>' must be connected to")}}m++}}function v(e,t,r){for(var n=e.tagName,o=null,i=e.length;i--;){var a=e[i],s=a.qName,u=a.value;if((f=s.indexOf(":"))>0)var l=a.prefix=s.slice(0,f),c=s.slice(f+1),p="xmlns"===l&&c;else c=s,l=null,p="xmlns"===s&&"";a.localName=c,!1!==p&&(null==o&&(o={},w(r,r={})),r[p]=o[p]=u,a.uri="http://www.w3.org/2000/xmlns/",t.startPrefixMapping(p,u))}for(i=e.length;i--;){(l=(a=e[i]).prefix)&&("xml"===l&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==l&&(a.uri=r[l||""]))}var f;(f=n.indexOf(":"))>0?(l=e.prefix=n.slice(0,f),c=e.localName=n.slice(f+1)):(l=null,c=e.localName=n);var h=e.uri=r[l||""];if(t.startElement(h,c,n,e),!e.closed)return e.currentNSMap=r,e.localNSMap=o,!0;if(t.endElement(h,c,n),o)for(l in o)t.endPrefixMapping(l)}function y(e,t,r,n,o){if(/^(?:script|textarea)$/i.test(r)){var i=e.indexOf("</"+r+">",t),a=e.substring(t+1,i);if(/[&<]/.test(a))return/^script$/i.test(r)?(o.characters(a,0,a.length),i):(a=a.replace(/&#?\w+;/g,n),o.characters(a,0,a.length),i)}return t+1}function x(e,t,r,n){var o=n[r];return null==o&&((o=e.lastIndexOf("</"+r+">"))<t&&(o=e.lastIndexOf("</"+r)),n[r]=o),o<t}function w(e,t){for(var r in e)t[r]=e[r]}function T(e,t,r,n){if("-"===e.charAt(t+2))return"-"===e.charAt(t+3)?(o=e.indexOf("--\x3e",t+4))>t?(r.comment(e,t+4,o-t-4),o+3):(n.error("Unclosed comment"),-1):-1;if("CDATA["==e.substr(t+3,6)){var o=e.indexOf("]]>",t+9);return r.startCDATA(),r.characters(e,t+9,o-t-9),r.endCDATA(),o+3}var i=function(e,t){var r,n=[],o=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;o.lastIndex=t,o.exec(e);for(;r=o.exec(e);)if(n.push(r),r[1])return n}(e,t),a=i.length;if(a>1&&/!doctype/i.test(i[0][0])){var s=i[1][0],u=a>3&&/^public$/i.test(i[2][0])&&i[3][0],l=a>4&&i[4][0],c=i[a-1];return r.startDTD(s,u&&u.replace(/^(['"])(.*?)\1$/,"$2"),l&&l.replace(/^(['"])(.*?)\1$/,"$2")),r.endDTD(),c.index+c[0].length}return-1}function b(e,t,r){var n=e.indexOf("?>",t);if(n){var o=e.substring(t,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(o){o[0].length;return r.processingInstruction(o[1],o[2]),n+2}return-1}return-1}function N(e){}function E(e,t){return e.__proto__=t,e}d.prototype={parse:function(e,t,r){var n=this.domBuilder;n.startDocument(),w(t,t={}),function(e,t,r,n,o){function i(e){if(e>65535){var t=55296+((e-=65536)>>10),r=56320+(1023&e);return String.fromCharCode(t,r)}return String.fromCharCode(e)}function a(e){var t=e.slice(1,-1);return t in r?r[t]:"#"===t.charAt(0)?i(parseInt(t.substr(1).replace("x","0x"))):(o.error("entity not found:"+e),e)}function s(t){if(t>w){var r=e.substring(w,t).replace(/&#?\w+;/g,a);f&&u(w),n.characters(r,0,t-w),w=t}}function u(t,r){for(;t>=c&&(r=p.exec(e));)l=r.index,c=l+r[0].length,f.lineNumber++;f.columnNumber=t-l+1}var l=0,c=0,p=/.*(?:\r\n?|\n)|.*$/g,f=n.locator,h=[{currentNSMap:t}],d={},w=0;for(;;){try{var E=e.indexOf("<",w);if(E<0){if(!e.substr(w).match(/^\s*$/)){var C=n.doc,S=C.createTextNode(e.substr(w));C.appendChild(S),n.currentElement=S}return}switch(E>w&&s(E),e.charAt(E+1)){case"/":var D=e.indexOf(">",E+3),_=e.substring(E+2,D),I=h.pop();D<0?(_=e.substring(E+2).replace(/[\s<].*/,""),o.error("end tag name: "+_+" is not complete:"+I.tagName),D=E+1+_.length):_.match(/\s</)&&(_=_.replace(/[\s<].*/,""),o.error("end tag name: "+_+" maybe not complete"),D=E+1+_.length);var P=I.localNSMap,O=I.tagName==_;if(O||I.tagName&&I.tagName.toLowerCase()==_.toLowerCase()){if(n.endElement(I.uri,I.localName,_),P)for(var A in P)n.endPrefixMapping(A);O||o.fatalError("end tag name: "+_+" is not match the current start tagName:"+I.tagName)}else h.push(I);D++;break;case"?":f&&u(E),D=b(e,E,n);break;case"!":f&&u(E),D=T(e,E,n,o);break;default:f&&u(E);var M=new N,k=h[h.length-1].currentNSMap,R=(D=g(e,E,M,k,a,o),M.length);if(!M.closed&&x(e,D,M.tagName,d)&&(M.closed=!0,r.nbsp||o.warning("unclosed xml attribute")),f&&R){for(var L=m(f,{}),F=0;F<R;F++){var j=M[F];u(j.offset),j.locator=m(f,{})}n.locator=L,v(M,n,k)&&h.push(M),n.locator=f}else v(M,n,k)&&h.push(M);"http://www.w3.org/1999/xhtml"!==M.uri||M.closed?D++:D=y(e,D,M.tagName,a,n)}}catch(e){o.error("element parse error: "+e),D=-1}D>w?w=D:s(Math.max(E,w)+1)}}(e,t,r,n,this.errorHandler),n.endDocument()}},N.prototype={setTagName:function(e){if(!i.test(e))throw new Error("invalid tagName:"+e);this.tagName=e},add:function(e,t,r){if(!i.test(e))throw new Error("invalid attribute:"+e);this[this.length++]={qName:e,value:t,offset:r}},length:0,getLocalName:function(e){return this[e].localName},getLocator:function(e){return this[e].locator},getQName:function(e){return this[e].qName},getURI:function(e){return this[e].uri},getValue:function(e){return this[e].value}},E({},E.prototype)instanceof E||(E=function(e,t){function r(){}for(t in r.prototype=t,r=new r,e)r[t]=e[t];return r}),r.XMLReader=d},{}],"/src/js/docxtemplater.js":[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=e("./doc-utils");o.traits=e("./traits"),o.moduleWrapper=e("./module-wrapper");var i=o.defaults,a=o.str2xml,s=o.xml2str,u=o.moduleWrapper,l=o.concatArrays,c=o.unique,p=e("./errors"),f=p.XTInternalError,h=p.throwFileTypeNotIdentified,d=p.throwFileTypeNotHandled,m=function(){function e(){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),arguments.length>0)throw new Error("The constructor with parameters has been removed in docxtemplater 3, please check the upgrade guide.");this.compiled={},this.modules=[],this.setOptions({})}return n(e,[{key:"setModules",value:function(e){this.modules.forEach((function(t){t.set(e)}))}},{key:"sendEvent",value:function(e){this.modules.forEach((function(t){t.on(e)}))}},{key:"attachModule",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).prefix;return t&&(e.prefix=t),this.modules.push(u(e)),this}},{key:"setOptions",value:function(e){var t=this;return this.options=e,Object.keys(i).forEach((function(e){var r=i[e];t.options[e]=null!=t.options[e]?t.options[e]:r,t[e]=t.options[e]})),this.zip&&this.updateFileTypeConfig(),this}},{key:"loadZip",value:function(e){if(e.loadAsync)throw new f("Docxtemplater doesn't handle JSZip version >=3, see changelog");return this.zip=e,this.updateFileTypeConfig(),this.modules=l([this.fileTypeConfig.baseModules.map((function(e){return e()})),this.modules]),this}},{key:"compileFile",value:function(e){var t=this.createTemplateClass(e);t.parse(),this.compiled[e]=t}},{key:"resolveData",value:function(e){var t=this;return Promise.all(Object.keys(this.compiled).map((function(r){return t.compiled[r].resolveTags(e)}))).then((function(e){return l(e)}))}},{key:"compile",value:function(){var e=this;return Object.keys(this.compiled).length||(this.options=this.modules.reduce((function(t,r){return r.optionsTransformer(t,e)}),this.options),this.options.xmlFileNames=c(this.options.xmlFileNames),this.xmlDocuments=this.options.xmlFileNames.reduce((function(t,r){var n=e.zip.files[r].asText();return t[r]=a(n),t}),{}),this.setModules({zip:this.zip,xmlDocuments:this.xmlDocuments}),this.getTemplatedFiles(),this.setModules({compiled:this.compiled}),this.templatedFiles.forEach((function(t){null!=e.zip.files[t]&&e.compileFile(t)}))),this}},{key:"updateFileTypeConfig",value:function(){var t=void 0;return this.zip.files.mimetype&&(t="odt"),(this.zip.files["word/document.xml"]||this.zip.files["word/document2.xml"])&&(t="docx"),this.zip.files["ppt/presentation.xml"]&&(t="pptx"),"odt"===t&&d(t),t||h(),this.fileType=t,this.fileTypeConfig=this.options.fileTypeConfig||e.FileTypeConfig[this.fileType],this}},{key:"render",value:function(){var e=this;return this.compile(),this.setModules({data:this.data}),this.mapper=this.modules.reduce((function(e,t){return t.getRenderedMap(e)}),{}),this.fileTypeConfig.tagsXmlLexedArray=c(this.fileTypeConfig.tagsXmlLexedArray),this.fileTypeConfig.tagsXmlTextArray=c(this.fileTypeConfig.tagsXmlTextArray),Object.keys(this.mapper).forEach((function(t){var r=e.mapper[t],n=r.from,o=r.data,i=e.compiled[n];i.setTags(o),i.render(t),e.zip.file(t,i.content,{createFolders:!0})})),this.sendEvent("syncing-zip"),this.syncZip(),this}},{key:"syncZip",value:function(){var e=this;Object.keys(this.xmlDocuments).forEach((function(t){e.zip.remove(t);var r=s(e.xmlDocuments[t]);return e.zip.file(t,r,{createFolders:!0})}))}},{key:"setData",value:function(e){return this.data=e,this}},{key:"getZip",value:function(){return this.zip}},{key:"createTemplateClass",value:function(e){var t=this.zip.files[e].asText();return this.createTemplateClassFromContent(t,e)}},{key:"createTemplateClassFromContent",value:function(t,r){var n=this,o={filePath:r};return Object.keys(i).forEach((function(e){o[e]=n[e]})),o.fileTypeConfig=this.fileTypeConfig,o.modules=this.modules,new e.XmlTemplater(t,o)}},{key:"getFullText",value:function(e){return this.createTemplateClass(e||this.fileTypeConfig.textPath(this.zip)).getFullText()}},{key:"getTemplatedFiles",value:function(){return this.templatedFiles=this.fileTypeConfig.getTemplatedFiles(this.zip),this.templatedFiles}}]),e}();m.DocUtils=o,m.Errors=e("./errors"),m.XmlTemplater=e("./xml-templater"),m.FileTypeConfig=e("./file-type-config"),m.XmlMatcher=e("./xml-matcher"),t.exports=m},{"./doc-utils":1,"./errors":2,"./file-type-config":3,"./module-wrapper":6,"./traits":16,"./xml-matcher":17,"./xml-templater":18}]},{},[])("/src/js/docxtemplater.js")}));