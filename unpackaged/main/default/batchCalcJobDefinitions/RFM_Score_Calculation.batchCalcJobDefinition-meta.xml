<?xml version="1.0" encoding="UTF-8"?>
<BatchCalcJobDefinition xmlns="http://soap.sforce.com/2006/04/metadata">
    <datasources>
        <fields>
            <alias>Id</alias>
            <dataType>Text</dataType>
            <name>Id</name>
        </fields>
        <fields>
            <alias>RE</alias>
            <dataType>Numeric</dataType>
            <name>DaysSinceLastGift</name>
        </fields>
        <fields>
            <alias>FR</alias>
            <dataType>Numeric</dataType>
            <name>GiftCount</name>
        </fields>
        <fields>
            <alias>MO</alias>
            <dataType>Numeric</dataType>
            <name>TotalGiftsAmount</name>
        </fields>
        <label>DS_1</label>
        <name>DS_1</name>
        <sourceName>DonorGiftSummary</sourceName>
        <type>StandardObject</type>
    </datasources>
    <description>Calculates the recency, frequency, monetary value, and composite scores that contribute to donor value analysis.</description>
    <executionPlatformType>CRMA</executionPlatformType>
    <isTemplate>false</isTemplate>
    <label>RFM Score Calculation</label>
    <processType>DataProcessingEngine</processType>
    <status>Active</status>
    <transforms>
        <expressionFields>
            <alias>Frequency</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>0</decimalPlaces>
            <expression>CASE(1,IF((ISNULL({FR})||{FR}&lt;0),1,0),5,IF({FR}&lt;40,1,0),5,IF({FR}&lt;80,1,0),4,IF({FR}&lt;120,1,0),3,IF({FR}&lt;160,1,0),2,1)</expression>
            <length>1</length>
        </expressionFields>
        <expressionFields>
            <alias>Monetary</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>0</decimalPlaces>
            <expression>CASE(1,IF((ISNULL({MO})||{MO}&lt;0),1,0),5,IF({MO}&lt;100,1,0),5,IF({MO}&lt;500,1,0),4,IF({MO}&lt;10000,1,0),3,IF({MO}&lt;20000,1,0),2,1)</expression>
            <length>1</length>
        </expressionFields>
        <expressionFields>
            <alias>Recency</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>0</decimalPlaces>
            <expression>CASE(1,IF((ISNULL({RE})||{RE}&lt;0),1,0),5,IF({RE}&lt;10,1,0),1,IF({RE}&lt;40,1,0),2,IF({RE}&lt;80,1,0),3,IF({RE}&lt;120,1,0),4,5)</expression>
            <length>1</length>
        </expressionFields>
        <label>Assign Buckets</label>
        <name>Assign_Buckets</name>
        <sourceName>DS_1</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <transforms>
        <expressionFields>
            <alias>RFMScore</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>0</decimalPlaces>
            <expression>{Recency} * 100 + {Frequency} * 10 + {Monetary}</expression>
            <length>3</length>
        </expressionFields>
        <label>Calculate Composite Score</label>
        <name>Calculate_Composite_Score</name>
        <sourceName>Assign_Buckets</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <writebacks>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>Id</sourceFieldName>
            <targetFieldName>Id</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>Recency</sourceFieldName>
            <targetFieldName>RecencyScore</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>Frequency</sourceFieldName>
            <targetFieldName>FrequencyScore</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>Monetary</sourceFieldName>
            <targetFieldName>MonetaryScore</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>RFMScore</sourceFieldName>
            <targetFieldName>CompositeRfmScore</targetFieldName>
        </fields>
        <isChangedRow>false</isChangedRow>
        <label>WB_1</label>
        <name>WB_1</name>
        <operationType>Update</operationType>
        <sourceName>Calculate_Composite_Score</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>DonorGiftSummary</targetObjectName>
        <writebackSequence>1</writebackSequence>
        <writebackUser>005dN000002IjK6QAK</writebackUser>
    </writebacks>
</BatchCalcJobDefinition>
